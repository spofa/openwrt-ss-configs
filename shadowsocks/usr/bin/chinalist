#!/bin/sh

# Author: https://github.com/softwaredownload/openwrt-fanqiang
# Date:   2014-07-12

tmpAcceleratedDomains=/tmp/accelerated-domains.china.conf
acceleratedDomains=/etc/dnsmasq.d/accelerated-domains.china.conf

flag=0

wget -4 --no-check-certificate -O $tmpAcceleratedDomains https://github.com/felixonmars/dnsmasq-china-list/raw/master/accelerated-domains.china.conf

if [ -e $tmpAcceleratedDomains ] && [ `cat $tmpAcceleratedDomains | wc -l` -gt 0 ]; then
    oldMd5sum=`md5sum $acceleratedDomains | awk '{print substr($1,1)}'`
    newMd5sum=`md5sum $tmpAcceleratedDomains | awk '{print substr($1,1)}'`

    if [ $newMd5sum = $oldMd5sum ]; then
        :
    else
        mv $tmpAcceleratedDomains $acceleratedDomains
        flag=1
    fi;
else
    :
fi;

tmpBogusNxdomainChina=/tmp/bogus-nxdomain.china.conf
bogusNxdomainChina=/etc/dnsmasq.d/bogus-nxdomain.china.conf

wget -4 --no-check-certificate -O $tmpBogusNxdomainChina https://github.com/felixonmars/dnsmasq-china-list/raw/master/bogus-nxdomain.china.conf

if [ -e $tmpBogusNxdomainChina ] && [ `cat $tmpBogusNxdomainChina | wc -l` -gt 0 ]; then
    oldMd5sum=`md5sum $bogusNxdomainChina | awk '{print substr($1,1)}'`
    newMd5sum=`md5sum $tmpBogusNxdomainChina | awk '{print substr($1,1)}'`

    if [ newMd5sum = oldMd5sum ]; then
        :
    else
        mv $tmpBogusNxdomainChina $bogusNxdomainChina
        flag=1
    fi;
else
    :
fi;

if [ $flag -eq 1 ]; then
    /etc/init.d/dnsmasq restart
else
    :
fi;
